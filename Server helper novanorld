local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local MarketplaceService = game:GetService("MarketplaceService")
local player = Players.LocalPlayer

local saveFile = "list.json"

local serverList = {}
if isfile and isfile(saveFile) then
    local success, data = pcall(function()
        return HttpService:JSONDecode(readfile(saveFile))
    end)
    if success and typeof(data) == "table" then
        serverList = data
    end
end

local function saveList()
    if writefile then
        pcall(function()
            writefile(saveFile, HttpService:JSONEncode(serverList))
        end)
    end
end

local function getGameName()
    local success, info = pcall(MarketplaceService.GetProductInfo, MarketplaceService, game.PlaceId)
    if success and info then
        return info.Name or "Game"
    else
        return "Game"
    end
end

local sg = Instance.new("ScreenGui")
sg.Name = "GuiX"
sg.ResetOnSpawn = false
sg.Parent = player:WaitForChild("PlayerGui", 10)

local function addCorner(parent, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 12)
    corner.Parent = parent
end

local function addPurpleStroke(parent, thickness)
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(180, 100, 255)
    stroke.Thickness = thickness or 2
    stroke.Transparency = 0.4
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.LineJoinMode = Enum.LineJoinMode.Round
    stroke.Parent = parent
end

local bgMain     = Color3.fromRGB(18, 15, 25)
local bgDark     = Color3.fromRGB(28, 22, 38)
local bgButton   = Color3.fromRGB(45, 35, 60)
local accent     = Color3.fromRGB(180, 100, 255)
local textWhite  = Color3.new(0.95, 0.92, 1)
local noteColor  = Color3.fromRGB(200, 140, 255)
local creditColor = Color3.fromRGB(160, 120, 220)
local counterColor = Color3.fromRGB(220, 160, 255)

local main = Instance.new("Frame")
main.Size = UDim2.new(0, 520, 0, 340)
main.Position = UDim2.new(0.5, -260, 0.5, -170)
main.BackgroundColor3 = bgMain
main.BorderSizePixel = 0
main.ClipsDescendants = true
main.Active = true
main.Draggable = true
main.Parent = sg
addCorner(main, 16)
addPurpleStroke(main, 2.5)

local title = Instance.new("Frame")
title.Size = UDim2.new(1, 0, 0, 44)
title.BackgroundColor3 = bgDark
title.Parent = main
addCorner(title, 16)
addPurpleStroke(title, 1.5)

local titleText = Instance.new("TextLabel")
titleText.Size = UDim2.new(0.5, 0, 1, 0)
titleText.Position = UDim2.new(0, 16, 0, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "Server Helper"
titleText.TextColor3 = accent
titleText.TextSize = 22
titleText.Font = Enum.Font.SourceSansBold
titleText.TextXAlignment = Enum.TextXAlignment.Left
titleText.Parent = title

local creditText = Instance.new("TextLabel")
creditText.Size = UDim2.new(0, 200, 1, 0)
creditText.Position = UDim2.new(0.5, -100, 0, 0)
creditText.BackgroundTransparency = 1
creditText.Text = "Made by Novanorld"
creditText.TextColor3 = creditColor
creditText.TextSize = 12
creditText.Font = Enum.Font.SourceSansItalic
creditText.TextXAlignment = Enum.TextXAlignment.Center
creditText.Parent = title

local minBtn = Instance.new("TextButton")
minBtn.Size = UDim2.new(0, 40, 0, 44)
minBtn.Position = UDim2.new(1, -80, 0, 0)
minBtn.BackgroundColor3 = bgButton
minBtn.Text = "-"
minBtn.TextColor3 = accent
minBtn.TextSize = 24
minBtn.Parent = title
addCorner(minBtn, 10)
addPurpleStroke(minBtn, 1)

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 40, 0, 44)
closeBtn.Position = UDim2.new(1, -40, 0, 0)
closeBtn.BackgroundColor3 = Color3.fromRGB(120, 40, 80)
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.new(1,0.9,0.95)
closeBtn.TextSize = 20
closeBtn.Parent = title
addCorner(closeBtn, 10)
addPurpleStroke(closeBtn, 1)
closeBtn.MouseButton1Click:Connect(function()
    sg:Destroy()
end)

local minIcon = Instance.new("TextButton")
minIcon.Size = UDim2.new(0, 80, 0, 80)
minIcon.Position = UDim2.new(0.5, -40, 0.5, -40)
minIcon.BackgroundColor3 = bgDark
minIcon.Text = "‚òÅÔ∏è"
minIcon.TextScaled = true
minIcon.TextColor3 = accent
minIcon.Font = Enum.Font.SourceSansBold
minIcon.Visible = false
minIcon.Active = true
minIcon.Draggable = true
minIcon.Parent = sg
addCorner(minIcon, 40)
addPurpleStroke(minIcon, 2.5)

local minimized = false
local function toggleMinimize()
    minimized = not minimized
    main.Visible = not minimized
    minIcon.Visible = minimized
end

minBtn.MouseButton1Click:Connect(toggleMinimize)
minIcon.MouseButton1Click:Connect(toggleMinimize)

local counterLabel = Instance.new("TextLabel")
counterLabel.Size = UDim2.new(0, 220, 0, 30)
counterLabel.Position = UDim2.new(0.5, -110, 0, 44)
counterLabel.BackgroundTransparency = 1
counterLabel.Text = "Server Checker: 0"
counterLabel.TextColor3 = counterColor
counterLabel.TextSize = 16
counterLabel.Font = Enum.Font.SourceSansSemibold
counterLabel.Parent = main

local function updateCounter()
    counterLabel.Text = "Server Checker: " .. #serverList
end

-- Baris tombol atas
local buttonRow = Instance.new("Frame")
buttonRow.Size = UDim2.new(1, -20, 0, 44)
buttonRow.Position = UDim2.new(0, 10, 0, 74)
buttonRow.BackgroundTransparency = 1
buttonRow.Parent = main

local function makeBtn(text, posX, callback)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(0, 60, 1, 0)
    b.Position = UDim2.new(0, posX, 0, 0)
    b.BackgroundColor3 = bgButton
    b.Text = text
    b.TextColor3 = accent
    b.TextSize = 26
    b.Font = Enum.Font.SourceSans
    b.Parent = buttonRow
    addCorner(b, 12)
    addPurpleStroke(b, 1.2)
    if callback then b.MouseButton1Click:Connect(callback) end
    return b
end

makeBtn("üíæ", 0, function()
    if setclipboard then setclipboard(game.JobId or "No JobId") end
end)

makeBtn("‚ûï", 80, function()
    if game.JobId and game.JobId ~= "" then
        local gameName = getGameName()
        table.insert(serverList, {
            name = gameName,
            jobId = game.JobId
        })
        saveList()
        refresh()
        updateCounter()
    end
end)

local publishBtn = makeBtn("üí≠", 160)

local searchBtn = makeBtn("üîç", 240, function()
    local searchPopup = Instance.new("Frame")
    searchPopup.Size = UDim2.new(0, 320, 0, 140)
    searchPopup.Position = UDim2.new(0.5, -160, 0.5, -70)
    searchPopup.BackgroundColor3 = bgMain
    searchPopup.BorderSizePixel = 0
    searchPopup.Active = true
    searchPopup.Draggable = true
    searchPopup.Parent = sg
    addCorner(searchPopup, 16)
    addPurpleStroke(searchPopup, 2.5)

    local closeSearch = Instance.new("TextButton")
    closeSearch.Size = UDim2.new(0, 30, 0, 30)
    closeSearch.Position = UDim2.new(1, -35, 0, 5)
    closeSearch.BackgroundColor3 = Color3.fromRGB(120, 40, 80)
    closeSearch.Text = "X"
    closeSearch.TextColor3 = Color3.new(1,1,1)
    closeSearch.TextSize = 16
    closeSearch.Parent = searchPopup
    addCorner(closeSearch, 8)
    closeSearch.MouseButton1Click:Connect(function()
        searchPopup:Destroy()
    end)

    local input = Instance.new("TextBox")
    input.Size = UDim2.new(0.85, 0, 0, 36)
    input.Position = UDim2.new(0.075, 0, 0.2, 0)
    input.BackgroundColor3 = bgButton
    input.TextColor3 = textWhite
    input.PlaceholderText = "Search server name (e.g., nat)"
    input.TextSize = 16
    input.Parent = searchPopup
    addCorner(input, 10)
    addPurpleStroke(input, 1)

    local searchAction = Instance.new("TextButton")
    searchAction.Size = UDim2.new(0.4, 0, 0, 40)
    searchAction.Position = UDim2.new(0.075, 0, 0.55, 0)
    searchAction.BackgroundColor3 = Color3.fromRGB(100, 60, 160)
    searchAction.Text = "Search"
    searchAction.TextColor3 = Color3.new(1,1,1)
    searchAction.TextSize = 18
    searchAction.Parent = searchPopup
    addCorner(searchAction, 10)
    addPurpleStroke(searchAction, 1.5)

    local resetAction = Instance.new("TextButton")
    resetAction.Size = UDim2.new(0.4, 0, 0, 40)
    resetAction.Position = UDim2.new(0.525, 0, 0.55, 0)
    resetAction.BackgroundColor3 = Color3.fromRGB(80, 80, 120)
    resetAction.Text = "Reset"
    resetAction.TextColor3 = Color3.new(1,1,1)
    resetAction.TextSize = 18
    resetAction.Parent = searchPopup
    addCorner(resetAction, 10)
    addPurpleStroke(resetAction, 1.5)

    local status = Instance.new("TextLabel")
    status.Size = UDim2.new(0.85, 0, 0, 30)
    status.Position = UDim2.new(0.075, 0, 0.85, 0)
    status.BackgroundTransparency = 1
    status.Text = ""
    status.TextColor3 = noteColor
    status.TextSize = 14
    status.Font = Enum.Font.SourceSans
    status.Parent = searchPopup

    searchAction.MouseButton1Click:Connect(function()
        local keyword = input.Text:lower()
        if keyword == "" then
            status.Text = "Enter a keyword"
            return
        end

        refresh(keyword)
        status.Text = "Showing results for: " .. keyword
    end)

    resetAction.MouseButton1Click:Connect(function()
        refresh("")
        status.Text = "Showing all servers"
        input.Text = ""
    end)
end)

-- Note (dipindah ke baris kedua agar tidak bertabrakan dengan search button)
local noteFrame = Instance.new("Frame")
noteFrame.Size = UDim2.new(1, -20, 0, 30)
noteFrame.Position = UDim2.new(0, 10, 0, 118)  -- tepat di bawah baris tombol
noteFrame.BackgroundTransparency = 1
noteFrame.Parent = main

local noteLabel = Instance.new("TextLabel")
noteLabel.Size = UDim2.new(1, 0, 1, 0)
noteLabel.BackgroundTransparency = 1
noteLabel.Text = "Note: You must join the game first before joining another server in a different game."
noteLabel.TextColor3 = noteColor
noteLabel.TextSize = 13
noteLabel.Font = Enum.Font.SourceSansItalic
noteLabel.TextXAlignment = Enum.TextXAlignment.Left
noteLabel.TextWrapped = true
noteLabel.Parent = noteFrame

local scroll = Instance.new("ScrollingFrame")
scroll.Size = UDim2.new(1, -20, 1, -170)  -- dikecilkan sedikit agar muat note di atas
scroll.Position = UDim2.new(0, 10, 0, 148)
scroll.BackgroundTransparency = 1
scroll.ScrollBarThickness = 6
scroll.ScrollBarImageColor3 = accent
scroll.Parent = main
addCorner(scroll, 12)
addPurpleStroke(scroll, 1.5)

local layout = Instance.new("UIListLayout")
layout.Padding = UDim.new(0, 8)
layout.Parent = scroll

local joinBtn = Instance.new("TextButton")
joinBtn.Size = UDim2.new(1, -20, 0, 44)
joinBtn.Position = UDim2.new(0, 10, 1, -54)
joinBtn.BackgroundColor3 = Color3.fromRGB(90, 50, 140)
joinBtn.Text = "Join Selected Server"
joinBtn.TextColor3 = Color3.new(1,0.95,1)
joinBtn.TextSize = 19
joinBtn.Font = Enum.Font.SourceSansSemibold
joinBtn.Parent = main
addCorner(joinBtn, 14)
addPurpleStroke(joinBtn, 2)

local selectedJob = nil
joinBtn.MouseButton1Click:Connect(function()
    if selectedJob then
        pcall(TeleportService.TeleportToPlaceInstance, TeleportService, game.PlaceId, selectedJob)
    end
end)

function refresh(filterKeyword)
    for _, child in ipairs(scroll:GetChildren()) do
        if child:IsA("GuiObject") and child ~= layout then
            child:Destroy()
        end
    end

    local keyword = (filterKeyword or ""):lower()
    local countShown = 0

    for i, srv in ipairs(serverList) do
        local nameLower = srv.name:lower()
        if keyword == "" or nameLower:find(keyword, 1, true) then
            countShown = countShown + 1

            local item = Instance.new("Frame")
            item.Size = UDim2.new(1, 0, 0, 38)
            item.BackgroundColor3 = bgDark
            item.Parent = scroll
            addCorner(item, 10)
            addPurpleStroke(item, 1)

            local nameLbl = Instance.new("TextLabel")
            nameLbl.Size = UDim2.new(1, -100, 1, 0)
            nameLbl.Position = UDim2.new(0, 12, 0, 0)
            nameLbl.BackgroundTransparency = 1
            nameLbl.Text = srv.name
            nameLbl.TextColor3 = textWhite
            nameLbl.TextSize = 16
            nameLbl.TextXAlignment = Enum.TextXAlignment.Left
            nameLbl.Parent = item

            local selBtn = Instance.new("TextButton")
            selBtn.Size = UDim2.new(0, 38, 1, 0)
            selBtn.Position = UDim2.new(1, -114, 0, 0)
            selBtn.BackgroundColor3 = bgButton
            selBtn.Text = "üü•"
            selBtn.TextSize = 22
            selBtn.TextColor3 = accent
            selBtn.Parent = item
            addCorner(selBtn, 8)
            addPurpleStroke(selBtn, 1)
            selBtn.MouseButton1Click:Connect(function()
                if selBtn.Text == "üü•" then
                    selBtn.Text = "üü©"
                    selectedJob = srv.jobId
                else
                    selBtn.Text = "üü•"
                    if selectedJob == srv.jobId then selectedJob = nil end
                end
            end)

            local copyB = Instance.new("TextButton")
            copyB.Size = UDim2.new(0, 38, 1, 0)
            copyB.Position = UDim2.new(1, -76, 0, 0)
            copyB.BackgroundColor3 = bgButton
            copyB.Text = "üíæ"
            copyB.TextSize = 22
            copyB.TextColor3 = accent
            copyB.Parent = item
            addCorner(copyB, 8)
            addPurpleStroke(copyB, 1)
            copyB.MouseButton1Click:Connect(function()
                if setclipboard then setclipboard(srv.jobId) end
            end)

            local delB = Instance.new("TextButton")
            delB.Size = UDim2.new(0, 38, 1, 0)
            delB.Position = UDim2.new(1, -38, 0, 0)
            delB.BackgroundColor3 = Color3.fromRGB(140, 50, 90)
            delB.Text = "‚ùå"
            delB.TextSize = 22
            delB.TextColor3 = Color3.new(1,0.9,0.95)
            delB.Parent = item
            addCorner(delB, 8)
            addPurpleStroke(delB, 1)
            delB.MouseButton1Click:Connect(function()
                table.remove(serverList, i)
                saveList()
                refresh(filterKeyword)
                updateCounter()
            end)
        end
    end

    scroll.CanvasSize = UDim2.new(0, 0, 0, countShown * 46)
    updateCounter()
end

refresh()
